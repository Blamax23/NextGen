@using NextGen.Model;

@model List<Question>;

@{
    ViewData["Title"] = "Foire aux Questions";
}

<link rel="stylesheet" href="~/css/Question.css" />

<div class="content">
    <h2>Foire Aux Questions</h2>
    <div class="tableau">
        @if (User.Identity.IsAuthenticated)
        {
            <div class="add-question-container">
                <button id="btnAddQuestion" class="btn btnAddQuestion" onclick="toggleForm()">
                    <div class="button-text">
                        Ajouter une question
                    </div>
                    <div class="button-more">
                        <i class="bi bi-plus-lg"></i>
                    </div>
                </button>
                <form asp-action="AddQuestion" method="post" enctype="multipart/form-data" class="question-form" id="formAddQuestion" style="display: none;">
                    <div class="question shadow-lg" style="margin: 0;">
                        <div class="question-zone-form">
                            <input type="text" name="question" class="inputQuestion" placeholder="Intitulé de la question" required />
                        </div>
                        <div class="reponse-zone-form">
                            <textarea name="reponse" class="form-control inputReponse" placeholder="Réponse à la question" required></textarea>
                            <div class="btns-close">
                                <button type="button" class="btn btn-danger" onclick="toggleForm()">Annuler</button>
                                <button type="submit" class="btn btn-success">Enregistrer</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        }
        @for (var i =0; i < Model.Count(); i++)
        {
            <div class="question shadow-lg">
                <div class="question-zone" id="question-@i">
                    <h3>@Model[i].Intitule</h3>
                    <i class="bi bi-chevron-right"></i>
                </div>
                <div class="reponse-zone" id="reponse-@i" style="display: none;">
                    <p style="margin: 0;">@Model[i].Reponse</p>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script type="text/javascript">
        function toggleForm() {
            var btn = document.getElementById("btnAddQuestion");
            var form = document.getElementById("formAddQuestion");
            if (form.style.display === "none") {
                form.style.display = "block";
                btn.style.display = "none";
            } else {
                form.style.display = "none";
                btn.style.display = "flex";
            }
        }

        var questions = document.querySelectorAll(".question-zone");

        questions.forEach((question, index) => {
            question.addEventListener('click', function () {
                var reponse = document.querySelector(`#reponse-${index}`);
                var icon = question.querySelector("i");
                var reponses = document.querySelectorAll(".reponse-zone");
                reponses.forEach((reponse, i) => {
                    if (index != i) {
                        reponse.style.display = "none";
                        reponse.previousElementSibling.style.borderBottomLeftRadius = "25px";
                        reponse.previousElementSibling.style.borderBottomRightRadius = "25px";
                        reponse.previousElementSibling.querySelector("i").style.transform = "rotate(0deg)";
                    }
                })
                // Toggle display for the corresponding answer
                if (reponse.style.display === "none" || reponse.style.display === "") {
                    reponse.style.display = "block";
                    question.style.borderBottomLeftRadius = "0px";
                    question.style.borderBottomRightRadius = "0px";

                    reponse.style.borderBottomLeftRadius = "0px";
                    reponse.style.borderBottomRightRadius = "0px";

                    // Rotate the icon 90 degrees
                    icon.style.transition = "transform 0.5s ease"; // Animation smooth
                    icon.style.transform = "rotate(90deg)";
                } else {
                    reponse.style.display = "none";
                    question.style.borderBottomLeftRadius = "25px";
                    question.style.borderBottomRightRadius = "25px";

                    // Rotate the icon back to 0 degrees
                    icon.style.transform = "rotate(0deg)";
                }
            });
        });
    </script>
}